import{Q as D}from"./QInput.c610543f.js";import{Q as j}from"./rtl.18b168d5.js";import{u as M,a as y,d as T,h as p,p as C,am as O,a5 as P,q as B,B as N,_ as E,s as L,o as H,P as I,S as s,U as i,W as c,X as m,aP as F}from"./index.136848cc.js";import{a as K,Q as g,b as W}from"./QTable.547193f4.js";import{Q as A}from"./QSelect.dc345e08.js";import{Q as G}from"./QPage.1bf84bfe.js";import"./uid.478f7271.js";import"./focus-manager.d6507951.js";import"./focusout.967b6d11.js";import"./use-model-toggle.9fff293e.js";import"./QList.d01c620f.js";import"./QChip.bfd3806e.js";import"./format.805cbadc.js";function v(e,a=new WeakMap){if(Object(e)!==e)return e;if(a.has(e))return a.get(e);const o=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const n=e.valueOf();if(Object(n)!==n){const u=new e.constructor(n);return a.set(e,u),u}}return a.set(e,o),e instanceof Set?e.forEach(n=>{o.add(v(n,a))}):e instanceof Map&&e.forEach((n,u)=>{o.set(u,v(n,a))}),Object.assign(o,...Object.keys(e).map(n=>({[n]:v(e[n],a)})))}var b=M({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:a,emit:o}){const{proxy:n}=C(),{$q:u}=n,r=y(null),t=y(""),l=y("");let d=!1;const _=T(()=>O({initialValue:t.value,validate:e.validate,set:h,cancel:w,updatePosition:R},"value",()=>l.value,f=>{l.value=f}));function h(){e.validate(l.value)!==!1&&(V()===!0&&(o("save",l.value,t.value),o("update:modelValue",l.value)),S())}function w(){V()===!0&&o("cancel",l.value,t.value),S()}function R(){P(()=>{r.value.updatePosition()})}function V(){return B(l.value,t.value)===!1}function S(){d=!0,r.value.hide()}function k(){d=!1,t.value=v(e.modelValue),l.value=v(e.modelValue),o("beforeShow")}function x(){o("show")}function q(){d===!1&&V()===!0&&(e.autoSave===!0&&e.validate(l.value)===!0?(o("save",l.value,t.value),o("update:modelValue",l.value)):o("cancel",l.value,t.value)),o("beforeHide")}function U(){o("hide")}function Q(){const f=a.default!==void 0?[].concat(a.default(_.value)):[];return e.title&&f.unshift(p("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&f.push(p("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[p(N,{flat:!0,color:e.color,label:e.labelCancel||u.lang.label.cancel,onClick:w}),p(N,{flat:!0,color:e.color,label:e.labelSet||u.lang.label.set,onClick:h})])),f}return Object.assign(n,{set:h,cancel:w,show(f){r.value!==null&&r.value.show(f)},hide(f){r.value!==null&&r.value.hide(f)},updatePosition:R}),()=>{if(e.disable!==!0)return p(j,{ref:r,class:"q-popup-edit",cover:e.cover,onBeforeShow:k,onShow:x,onBeforeHide:q,onHide:U,onEscapeKey:w},Q)}}});const J={data(){return{columns:[{name:"firstName",label:"First Name",required:!0,field:"firstName",sortable:!0,align:"left"},{name:"lastName",label:"Surname",field:"lastName",required:!0,sortable:!0,align:"left"},{name:"initials",label:"initials",field:"lastName",sortable:!1,align:"left"},{name:"role",label:"Role",required:!0,field:"role",sortable:!0,align:"left"},{name:"assignedDuties",label:"Duties Required",required:!0,field:"assignedDuties",sortable:!0,align:"left"},{name:"dutiesDone",label:"Duties Done",required:!0,field:"dutiesDone",sortable:!0,align:"left"},{name:"dutiesRemaining",label:"Duties Remaining",required:!0,field:"dutiesRemaining",sortable:!0,align:"left"}],rows:[],pagination:{rowsPerPage:0},roleOptions:["Super Tutor","No assembly duty"],exampleRows:[{rowID:"ytosgubasp;b23598yHGW4",firstName:"Matt",lastName:"Tracker",initials:"MAT",role:["No assembly duty"],assignedDuties:null,dutiesDone:null,dutiesRemaining:null}],isLoading:!1}},mounted(){this.getStaffFromDatabase()},methods:{getStaffFromDatabase(){this.isLoading=!0,fetch("https://wheatyfirstdatabase-default-rtdb.europe-west1.firebasedatabase.app/staffMembers.json").then(e=>{if(e.ok)return e.json();throw new Error("there was an error loading the staff members")}).then(e=>{for(const a in e)this.rows.push({rowID:a,firstName:e[a].firstName,lastName:e[a].lastName,initials:e[a].initials,role:e[a].role,assignedDuties:3,dutiesDone:0,dutiesRemaining:3});this.isLoading=!1}).catch(e=>{this.isLoading=!1,console.log(e)})},checkDuties(e){const a=L.getters.getEvents;let o=0;for(let n in a)for(let u in a[n].staff)a[n].staff[u]===e&&o++;return o},setRemainingDuties(){for(let e in this.exampleRows)console.log("initials: ",this.exampleRows[e].initials),console.log("duties Done: ",this.checkDuties(this.exampleRows[e].initials)),this.exampleRows[e].dutiesDone=this.checkDuties(this.exampleRows[e].initials),this.exampleRows[e].dutiesRemaining=this.exampleRows[e].assignedDuties-this.exampleRows[e].dutiesDone,console.log("done: ",this.exampleRows[e].dutiesDone),console.log("remaining: ",this.exampleRows[e].dutiesRemaining)},testMethod(e,a,o){console.log("value: ",e,"initialValue: ",a,o)},calculateDutiesRequired(e){return e==="No assembly duty"?3:e==="Super Tutor"?1:2},exportToDatabase(e,a,o,n){console.log("posting key: ",n,"and value: ",e),fetch("https://wheatyfirstdatabase-default-rtdb.europe-west1.firebasedatabase.app/staffMembers/"+o+".json",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({[n]:e})})}}};function X(e,a,o,n,u,r){return H(),I(G,{class:"q-pa-md"},{default:s(()=>[i(W,{pagination:u.pagination,"onUpdate:pagination":a[0]||(a[0]=t=>u.pagination=t),title:"Staff Loading",columns:u.columns,rows:u.rows,"row-key":t=>t.rowID,loading:u.isLoading,dense:"",flat:""},{body:s(t=>[i(K,{props:t},{default:s(()=>[i(g,{key:"firstName",props:t},{default:s(()=>[c(m(t.row.firstName)+" ",1),i(b,{modelValue:t.row.firstName,"onUpdate:modelValue":l=>t.row.firstName=l,"auto-save":"",onSave:(l,d)=>r.exportToDatabase(l,d,t.row.rowID,"firstName")},{default:s(l=>[i(D,{modelValue:l.value,"onUpdate:modelValue":d=>l.value=d,dense:"",autofocus:"",onKeyup:F(l.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),i(g,{key:"lastName",props:t},{default:s(()=>[c(m(t.row.lastName)+" ",1),i(b,{modelValue:t.row.lastName,"onUpdate:modelValue":l=>t.row.lastName=l,"auto-save":""},{default:s(l=>[i(D,{modelValue:l.value,"onUpdate:modelValue":d=>l.value=d,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),i(g,{key:"initials",props:t},{default:s(()=>[c(m(t.row.initials)+" ",1),i(b,{modelValue:t.row.initials,"onUpdate:modelValue":l=>t.row.initials=l,"auto-save":""},{default:s(l=>[i(D,{modelValue:l.value,"onUpdate:modelValue":d=>l.value=d,dense:"",autofocus:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),i(g,{key:"role",props:t},{default:s(()=>[c(m(t.row.role)+" ",1),i(b,{modelValue:t.row.role,"onUpdate:modelValue":l=>t.row.role=l,"auto-save":""},{default:s(l=>[i(A,{modelValue:l.value,"onUpdate:modelValue":d=>l.value=d,dense:"",autofocus:"",options:u.roleOptions},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),i(g,{key:"assignedDuties",props:t},{default:s(()=>[c(m(r.calculateDutiesRequired(t.row.role)),1)]),_:2},1032,["props"]),i(g,{key:"dutiesDone",props:t},{default:s(()=>[c(m(r.checkDuties(t.row.initials)),1)]),_:2},1032,["props"]),i(g,{key:"dutiesRemaining",props:t},{default:s(()=>[c(m(r.calculateDutiesRequired(t.row.role)-r.checkDuties(t.row.initials)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["pagination","columns","rows","row-key","loading"])]),_:1})}var re=E(J,[["render",X]]);export{re as default};
