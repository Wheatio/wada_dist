import{u as p,d as v,h as b,m as U,_ as C,s,o,O as d,P as r,T as n,U as w,V as _,W as g,ap as B,X as f,c as S,Y as x,Z as k,B as m}from"./index.23a141fd.js";import{d as h,Q as L}from"./use-model-toggle.81454eea.js";import{Q}from"./QChip.c1a39239.js";import{Q as E,a as I}from"./QCard.9f53c50a.js";import{Q as q}from"./QCardActions.f11e2357.js";import{Q as A}from"./QExpansionItem.68212f34.js";const T=["top","middle","bottom"];var y=p({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>T.includes(e)}},setup(e,{slots:t}){const l=v(()=>e.align!==void 0?{verticalAlign:e.align}:null),u=v(()=>{const i=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(i!==void 0?` text-${i}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>b("div",{class:u.value,style:l.value,role:"status","aria-label":e.label},U(t.default,e.label!==void 0?[e.label]:[]))}});const F={props:{event_details:{required:!0,type:Array},staff:{required:!0,type:Array}},emits:["update"],data(){return{deleteButtonLoading:!1}},computed:{cardText1(){return this.event_details.year_group+": "+this.event_details.event_title},currentUser(){return s.getters.getCurrentUser},isFull(){const e=this.event_details.staff_no,t=this.staff.length;return!(e-t>0)},spaceAvailable(){const e=this.event_details.staff_no,t=this.staff.length;return e-t>0?t+" / "+e:"FULL"},cardText2(){return this.staff?this.staff.length+" / "+this.event_details.staff_no:" / "},cardStyle(){return this.event_details.year_group==="Shell"?"orange":this.event_details.year_group==="Remove"?"green":this.event_details.year_group==="Hundred"?"yellow":this.event_details.year_group==="6th Form"?"blue":""},currentUserInEvent(){const e=s.getters.getCurrentUser;return!!this.staff.some(t=>t.toUpperCase()===e.toUpperCase())}},methods:{signUp(){if(!this.isFull){const e=s.getters.getStaffByInitials(s.getters.getCurrentUser),t={event_id:this.event_details.event_id,staff_id:e};console.log("adding ",t," to the database"),this.$emit("update"),s.dispatch("addStaffToEvent",t)}},async removeMe(){this.deleteButtonLoading=!0;try{let l=(await(await fetch(s.getters.getServerURL+`api/v1/public/loading/${this.currentUser}`)).json()).filter(a=>a.event_id===this.event_details.event_id);console.log(l[0].loading_id);let i=await(await fetch(s.getters.getServerURL+`api/v1/public/loading/${l[0].loading_id}`,{method:"DELETE"})).json();console.log(i.message),this.deleteButtonLoading=!1}catch{this.$q.notify("Error deleting you from this event"),this.deleteButtonLoading=!1}this.$emit("update")},swapUser(e){e.toUpperCase()===this.currentUser.toUpperCase()?this.$q.notify({message:"You can't swap you with yourself, you lunatic.",position:"center",color:"positive"}):this.currentUserInEvent?this.$q.notify("You're already signed up for this, you muppet."):this.$q.notify({position:"center",icon:"priority_high",message:"You are trying to remove "+e+" from their duty so you can take it. You MUST have discussed this with "+e+" first. A swap notification will be sent to the deputy head pastoral.",color:"negative",actions:[{label:"OK",handler:()=>this.reallySwapUser(e)},{label:"cancel"}]})},reallySwapUser(e){console.log("you have elected to swap ",e," for yourself. I hope you know what you're doing...");const t={event_id:this.event_details.event_id,old:e,new:this.currentUser};s.dispatch("updateStaff",t),this.$emit("update")}}},R={class:"badge-wrapper"};function V(e,t,l,u,i,a){return o(),d(A,{dense:""},{header:r(()=>[n(h,{avatar:""},{default:r(()=>[n(w,{color:a.cardStyle,size:"xs"},null,8,["color"])]),_:1}),n(h,null,{default:r(()=>[n(L,null,{default:r(()=>[_(g(l.event_details.year_group)+" - "+g(l.event_details.event_title),1)]),_:1})]),_:1}),n(h,{side:"",top:"",style:{"justify-content":"space-between","align-items":"center"}},{default:r(()=>[B("div",R,[a.currentUserInEvent?(o(),d(y,{key:0,color:"red-5",label:"Signed Up"})):f("",!0),n(y,{color:"teal",label:a.spaceAvailable},null,8,["label"])])]),_:1})]),default:r(()=>[n(I,null,{default:r(()=>[n(E,null,{default:r(()=>[(o(!0),S(k,null,x(l.staff,c=>(o(),d(Q,{key:c,clickable:"",onClick:M=>a.swapUser(c)},{default:r(()=>[_(g(c.toUpperCase()),1)]),_:2},1032,["onClick"]))),128))]),_:1}),n(q,{align:"right"},{default:r(()=>[!a.isFull&&!a.currentUserInEvent?(o(),d(m,{key:0,label:"sign up",rounded:"",flat:"",class:"bg-primary text-white",size:"sm",onClick:a.signUp},null,8,["onClick"])):f("",!0),a.currentUserInEvent?(o(),d(m,{key:1,label:"Remove Me",rounded:"",flat:"",class:"bg-negative text-white",loading:i.deleteButtonLoading,size:"sm",onClick:a.removeMe},null,8,["loading","onClick"])):f("",!0)]),_:1})]),_:1})]),_:1})}var O=C(F,[["render",V],["__scopeId","data-v-bf991474"]]);export{O as S};
