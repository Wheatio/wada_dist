import{Q as h}from"./QPage.e7f0660b.js";import{h as E,u as D,_ as g,s as m,o as V,P as b,S as a,at as f,U as t,V as T,B as _,T as U}from"./index.7751ba36.js";import{Q as p}from"./QInput.be2218fa.js";import{Q as c}from"./QSelect.a6795af7.js";import{Q as u,a as v,b as B}from"./QTable.fde49c89.js";import{d as w}from"./helpers.4e16fb27.js";import"./uid.8b32aede.js";import"./focus-manager.d6507951.js";import"./QChip.70bfd9e3.js";import"./use-model-toggle.b2859b1e.js";import"./rtl.afa6e43a.js";import"./focusout.2ca9c6c4.js";import"./format.27ac919b.js";import"./QList.8c2b1fb2.js";const k=E("div",{class:"q-space"});var y=D({name:"QSpace",setup(){return()=>k}});const F={data(){return{selection:[],pagination:{rowsPerPage:0},newEvent:{year_group:null,event_title:null,location:null,staff_no:4,date_id:null,counts_as:1},columns:[{name:"date",label:"Date",field:"date",align:"left",sortable:!0},{name:"yearGroup",label:"Year Group",field:"year_group",align:"left"},{name:"event",label:"Event Name",field:"event_title",align:"left",sortable:!0},{name:"location",label:"Location",field:"location",align:"left"},{name:"staff",label:"Staff",field:"staff_no",align:"left"},{name:"countsAs",label:"Worth # Duties",field:"counts_as",align:"center"},{name:"actions",label:"actions",label:"Actions",field:""}],yearOptions:["Shell","Remove","Hundred","6th Form"],textFilter:"",dateFilter:null}},computed:{rows(){const l=m.getters.getEvents.filter(s=>s.term===this.currentTerm.term&&s.year===this.currentTerm.year);let r=Array.from(l);return this.dateFilter&&(r=r.filter(s=>s.date_id===this.dateFilter)),r=r.filter(s=>s.event_title.includes(this.textFilter)),r},dates(){const n=m.getters.getFullDates,l=m.getters.getCurrentTerm,r=n.filter(s=>s.term===l.term&&s.year===l.year);return console.log("filteredDates",r),r},dateOptions(){const n=this.dates.map(({date_id:l,date:r})=>({label:w(r),value:l}));return console.log(n),n},dateFilterOptions(){const n=this.dateOptions;return n.unshift({label:"All",value:null}),n},displayDateFromId(n){return m.getters.getFullDates.find(s=>s.date_id===n).date},currentTerm(){return m.getters.getCurrentTerm}},methods:{formatDate(n){return w(n)},updateEvents(n){m.dispatch("updateEvents",this.rows[n])},addRow(){m.dispatch("addEvent",this.newEvent),this.rows.unshift(this.newEvent),this.newEvent={year_group:null,event_title:null,location:null,staff_no:4,date_id:null,counts_as:1}},deleteEvent(n){console.log("deleting ",n),m.dispatch("deleteEvent",n)},reallyDelete(n,l){console.log("reallyDelete"),this.$q.notify({position:"center",color:"red",message:"Really delete "+l+"?",icon:"warning",timeout:0,actions:[{label:"ok",handler:()=>{this.deleteEvent(n)},color:"white"},{label:"cancel",color:"white",handler:()=>{}}]})}}},x=f("div",{class:"col-3 q-table__title"},"Events This Term",-1),Q={class:"col-4"},S={class:"col-2"};function C(n,l,r,s,o,d){return V(),b(B,{selected:o.selection,"onUpdate:selected":l[8]||(l[8]=e=>o.selection=e),style:{"max-height":"80vh"},rows:d.rows,columns:o.columns,"row-key":e=>e.event_id,pagination:o.pagination,"virtual-scroll":""},{top:a(()=>[x,f("div",Q,[t(p,{modelValue:o.textFilter,"onUpdate:modelValue":l[0]||(l[0]=e=>o.textFilter=e),label:"Filter by event name",outlined:"",rounded:"",dense:""},{append:a(()=>[t(T,{icon:"search",size:"lg"})]),_:1},8,["modelValue"])]),t(y),f("div",S,[t(c,{modelValue:o.dateFilter,"onUpdate:modelValue":l[1]||(l[1]=e=>o.dateFilter=e),label:"filter by date",outlined:"",rounded:"",dense:"","emit-value":"","map-options":"",options:d.dateFilterOptions},null,8,["modelValue","options"])]),t(y),t(_,{round:"",flat:"",class:"bg-primary text-white",icon:"add",onClick:d.addRow},null,8,["onClick"])]),"top-row":a(()=>[t(v,{class:"bg-blue-2"},{default:a(()=>[t(u,null,{default:a(()=>[t(c,{modelValue:o.newEvent.date_id,"onUpdate:modelValue":l[2]||(l[2]=e=>o.newEvent.date_id=e),options:d.dateOptions,label:"Date","emit-value":"","map-options":"",dense:""},null,8,["modelValue","options"])]),_:1}),t(u,null,{default:a(()=>[t(c,{modelValue:o.newEvent.year_group,"onUpdate:modelValue":l[3]||(l[3]=e=>o.newEvent.year_group=e),options:o.yearOptions,label:"Year Group",placeholder:"Year Group",dense:""},null,8,["modelValue","options"])]),_:1}),t(u,null,{default:a(()=>[t(p,{modelValue:o.newEvent.event_title,"onUpdate:modelValue":l[4]||(l[4]=e=>o.newEvent.event_title=e),placeholder:"New Event Name",dense:""},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(p,{modelValue:o.newEvent.location,"onUpdate:modelValue":l[5]||(l[5]=e=>o.newEvent.location=e),placeholder:"Location",dense:"",style:{width:"130px"}},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(p,{modelValue:o.newEvent.staff_no,"onUpdate:modelValue":l[6]||(l[6]=e=>o.newEvent.staff_no=e),type:"number",dense:""},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(p,{modelValue:o.newEvent.counts_as,"onUpdate:modelValue":l[7]||(l[7]=e=>o.newEvent.counts_as=e),type:"number",dense:""},null,8,["modelValue"])]),_:1}),t(u)]),_:1})]),body:a(e=>[t(v,{props:e},{default:a(()=>[t(u,{key:"date",props:e},{default:a(()=>[t(c,{modelValue:e.row.date_id,"onUpdate:modelValue":i=>e.row.date_id=i,options:d.dateOptions,"emit-value":"","map-options":"",dense:"",borderless:"",onBlur:i=>d.updateEvents(e.rowIndex)},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),_:2},1032,["props"]),t(u,{key:"yearGroup",props:e},{default:a(()=>[t(c,{modelValue:e.row.year_group,"onUpdate:modelValue":i=>e.row.year_group=i,options:o.yearOptions,borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),_:2},1032,["props"]),t(u,{key:"event",props:e,style:{width:"300px"}},{default:a(()=>[t(p,{modelValue:e.row.event_title,"onUpdate:modelValue":i=>e.row.event_title=i,dense:"",borderless:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),t(u,{key:"location",props:e},{default:a(()=>[t(p,{modelValue:e.row.location,"onUpdate:modelValue":i=>e.row.location=i,dense:"",borderless:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),t(u,{key:"staff",props:e,style:{width:"60px"}},{default:a(()=>[t(p,{modelValue:e.row.staff_no,"onUpdate:modelValue":i=>e.row.staff_no=i,type:"number",borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),t(u,{key:"countsAs",props:e,style:{width:"50px"},onBlur:d.updateEvents},{default:a(()=>[t(p,{modelValue:e.row.counts_as,"onUpdate:modelValue":i=>e.row.counts_as=i,type:"number",borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props","onBlur"]),t(u,{key:"actions",props:e},{default:a(()=>[t(_,{icon:"delete",class:"text-grey-7",flat:"",dense:"",size:"sm",onClick:i=>d.reallyDelete(e.row.event_id,e.row.event_title)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["selected","rows","columns","row-key","pagination"])}var O=g(F,[["render",C]]);const A={components:{EventsTable:O},data(){return{selectedTab:"Whole Term",rightDrawerState:!0,dateIDsAreLoaded:!1}},computed:{dates(){const n=m.getters.getFullDates,l=m.getters.getCurrentTerm,r=n.filter(s=>s.term===l.term&&s.year===l.year);return r.length>0?r:[]}},methods:{selectTab(n){this.selectedTab=n},displayDate(n){let l=new Date(n);return l.getDate()+"/"+(l.getMonth()+1)}}};function P(n,l,r,s,o,d){const e=U("events-table");return V(),b(h,{class:"row no-wrap desktop-only"},{default:a(()=>[t(e)]),_:1})}var X=g(A,[["render",P],["__scopeId","data-v-4b16fa5e"]]);export{X as default};
