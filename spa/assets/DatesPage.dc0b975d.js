import{a as Q,b as C,c as S,g as W}from"./focusout.e7979856.js";import{Q as B,a as O}from"./QExpansionItem.2478246a.js";import{b as R,Q as Y,a as z}from"./QCard.d2b7f6fb.js";import{a as J}from"./QResizeObserver.52c1a134.js";import{Q as D}from"./QInput.ef0a602e.js";import{c as K,e as G,o as X,g as Z,R as w,Q as $}from"./QBtn.14214950.js";import{f as ee,p as te,a1 as ae,a2 as se,g as le,h as re,i as oe,N as L,U as ne,ak as ie,_ as de,o as m,v as h,x as o,a7 as v,z as n,A as p,c as E,D as U,F as H,B as j,E as V,C as ue,a8 as me,a9 as ce}from"./index.2d799746.js";import{c as fe}from"./focus-manager.e90105ca.js";import{Q as he}from"./QDialog.345f486f.js";import{Q as pe}from"./QPage.73459ef8.js";import{s as M}from"./staffing.62cbc36e.js";import"./scroll.32150d62.js";import"./uid.42677368.js";import"./QScrollObserver.2e0d7c24.js";import"./prevent-scroll.30fa5a95.js";var ge=K({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(t,{slots:e,emit:a}){const d=oe(),s=ee(null);let i=0;const l=[];function y(r){const b=typeof r=="boolean"?r:t.noErrorFocus!==!0,T=++i,I=(u,c)=>{a("validation"+(u===!0?"Success":"Error"),c)},P=u=>{const c=u.validate();return typeof c.then=="function"?c.then(g=>({valid:g,comp:u}),g=>({valid:!1,comp:u,err:g})):Promise.resolve({valid:c,comp:u})};return(t.greedy===!0?Promise.all(l.map(P)).then(u=>u.filter(c=>c.valid!==!0)):l.reduce((u,c)=>u.then(()=>P(c).then(g=>{if(g.valid===!1)return Promise.reject(g)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return T===i&&I(!0),!0;if(T===i){const{comp:c,err:g}=u[0];if(g!==void 0&&console.error(g),I(!1,c),b===!0){const N=u.find(({comp:q})=>typeof q.focus=="function"&&X(q.$)===!1);N!==void 0&&N.comp.focus()}}return!1})}function x(){i++,l.forEach(r=>{typeof r.resetValidation=="function"&&r.resetValidation()})}function f(r){r!==void 0&&L(r);const b=i+1;y().then(T=>{b===i&&T===!0&&(t.onSubmit!==void 0?a("submit",r):r!==void 0&&r.target!==void 0&&typeof r.target.submit=="function"&&r.target.submit())})}function _(r){r!==void 0&&L(r),a("reset"),ne(()=>{x(),t.autofocus===!0&&t.noResetFocus!==!0&&k()})}function k(){fe(()=>{if(s.value===null)return;const r=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),b=>b.tabIndex>-1);r!=null&&r.focus({preventScroll:!0})})}te(ie,{bindComponent(r){l.push(r)},unbindComponent(r){const b=l.indexOf(r);b>-1&&l.splice(b,1)}});let F=!1;return ae(()=>{F=!0}),se(()=>{F===!0&&t.autofocus===!0&&k()}),le(()=>{t.autofocus===!0&&k()}),Object.assign(d.proxy,{validate:y,resetValidation:x,submit:f,reset:_,focus:k,getValidationComponents:()=>l}),()=>re("form",{class:"q-form",ref:s,onSubmit:f,onReset:_},G(e.default))}});const ye={mounted(){let e=new Date().getFullYear();this.years.push(e);for(let a=0;a<3;a++)e++,this.years.push(e)},data(){return{michStart:null,exeat1:null,halfTerm:null,HTWeeks:null,exeat2:null,termEnd:null,saturdays:[],stringArray:[],years:[],term:null,datesNotAvailable:!1,formWarning:!1}},computed:{formValid(){return!!(this.michStart&&this.exeat1&&this.halfTerm&&this.HTWeeks&&this.exeat2&&this.termEnd)},dates(){let t=null,e=null,a=null,d=null,s=null;return this.michStart&&(t=this.michStart.replace(/-/g,"/")),this.exeat1&&(e=this.exeat1.replace(/-/g,"/")),this.halfTerm&&(a=this.halfTerm.replace(/-/g,"/")),this.exeat2&&(d=this.exeat2.replace(/-/g,"/")),this.termEnd&&(s=this.termEnd.replace(/-/g,"/")),[t,e,a,d,s]}},methods:{getSaturdays(){this.saturdays=[];const t=new Date(this.michStart),e=new Date(this.getSaturday(this.exeat1)),a=new Date(this.getSaturday(this.halfTerm)),d=new Date(this.getSaturday(this.exeat2)),s=new Date(this.termEnd);let i=new Date(t);for(i=new Date(this.getSaturday(i));i<s;)this.saturdays.push(new Date(i)),i.setDate(i.getDate()+7);const l=[];let y=this.generateHalfTerm(this.HTWeeks,a);l.push(e);for(let f=0;f<y.length;f++)l.push(y[f]);l.push(d);let x=this.saturdays.filter(f=>!l.find(_=>_.getDate()===f.getDate()));x=x.filter(f=>f.getDate()!==d.getDate()),this.saturdays=x},dateToString(){if(this.formValid){if(this.saturdays.length<2){this.getSaturdays();let t,e=[];for(let a=0;a<this.saturdays.length;a++)t=""+this.saturdays[a].getDate()+"-"+(this.saturdays[a].getMonth()+1)+"-"+this.saturdays[a].getFullYear(),e.push(t);this.stringArray=e,this.term?this.putDatesInDatabase(this.term,e):alert("Please select a term")}}else this.formWarning=!0},setTerm(t){this.term=t,this.getDatesFromStore()},putDatesInDatabase(t,e){console.log("attempting to put dates in database"),fetch("https://wheatyfirstdatabase-default-rtdb.europe-west1.firebasedatabase.app/dates.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:t,dates:e})}).then(a=>{if(a.ok)return console.log("dates successfully posted."),a.json()}).then(a=>{let d={};d={id:a.name,dates:e,term:t},M.dispatch("addDates",d),console.log("sending dates to the store: ",d),this.getDatesFromStore()}).catch(a=>{console.log("Oh noes, error! ",a)})},getSaturday(t){t=new Date(t);let e=t.getDay(),a=t.getDate()+(6-e);return new Date(t.setDate(a))},addAWeek(t){let e=new Date(t),a=e.getDate()+7;return new Date(e.setDate(a))},generateHalfTerm(t,e){let a=[],d=new Date(e);a.push(e);for(let s=0;s<t;s++)d=new Date(this.addAWeek(d)),a.push(d);return a},getDatesFromStore(){const t=this.term;console.log("current term = ",t);const e=M.getters.getDates;console.log("dates.dates = ",e);const a=e.filter(d=>d.term===t);a[0]?(console.log("filteredDates = ",a[0].dates),this.stringArray=a[0].dates,this.datesNotAvailable=!1):this.datesNotAvailable=!0}}},A=t=>(me("data-v-7e9f0e1d"),t=t(),ce(),t),be={class:"sidebar col-2",width:"250px"},ve={key:0,class:"q-pa-none col-10"},xe={class:"q-pa-md row"},De={class:"q-pa-lg",style:{"max-width":"400px"}},Se=A(()=>v("div",{class:"text-h6",style:{padding:"none"}},"Select Term Dates",-1)),_e=A(()=>v("div",{class:"q-pa-lg"},null,-1)),ke={class:"q-pa-lg",style:{"max-width":"400px"}},Te=A(()=>v("div",null,"Please complete all the term dates before submitting",-1));function we(t,e,a,d,s,i){return m(),h(pe,{class:"row"},{default:o(()=>[v("div",be,[n(R,{class:"fit"},{default:o(()=>[n(Q,{padding:"",class:"menu-list"},{default:o(()=>[n(C,{header:""},{default:o(()=>[p("Choose Term")]),_:1}),(m(!0),E(H,null,U(s.years,l=>(m(),h(O,{key:l,bordered:"","expand-separator":"",icon:"today",label:l.toString()},{default:o(()=>[V((m(),h(S,{clickable:"",label:"Michaelmas",onClick:y=>i.setTerm("Michaelmas "+l)},{default:o(()=>[p("Michaelmas")]),_:2},1032,["onClick"])),[[w]]),V((m(),h(S,{clickable:"",label:"Lent",onClick:y=>i.setTerm("Lent "+l)>t.Lent},{default:o(()=>[p("Lent")]),_:2},1032,["onClick"])),[[w]]),V((m(),h(S,{clickable:"",label:"Summer",onClick:y=>i.setTerm("Summer "+l)},{default:o(()=>[p("Summer")]),_:2},1032,["onClick"])),[[w]])]),_:2},1032,["label"]))),128))]),_:1})]),_:1})]),s.term?(m(),E("div",ve,[n(J,{class:"bg-secondary glossy text-white"},{default:o(()=>[s.term?(m(),h(B,{key:0},{default:o(()=>[p(j(s.term),1)]),_:1})):(m(),h(B,{key:1},{default:o(()=>[p("No term currently selected")]),_:1}))]),_:1}),v("div",xe,[v("div",De,[n(ge,null,{default:o(()=>[Se,n(D,{type:"date",id:"mich-start","fill-mask":"false","stack-label":"",modelValue:s.michStart,"onUpdate:modelValue":e[0]||(e[0]=l=>s.michStart=l),label:"First day of term"},null,8,["modelValue"]),n(D,{type:"date",id:"first-exeat","stack-label":"",modelValue:s.exeat1,"onUpdate:modelValue":e[1]||(e[1]=l=>s.exeat1=l),label:"1st exeat"},null,8,["modelValue"]),n(D,{type:"date",id:"half-term",modelValue:s.halfTerm,"onUpdate:modelValue":e[2]||(e[2]=l=>s.halfTerm=l),"stack-label":"",label:"1st day of half term"},null,8,["modelValue"]),n(D,{type:"number",id:"weeks-iin-half-term",modelValue:s.HTWeeks,"onUpdate:modelValue":e[3]||(e[3]=l=>s.HTWeeks=l),modelModifiers:{number:!0},label:"number of weeks in half term"},null,8,["modelValue"]),n(D,{type:"date",id:"second-exeat","stack-label":"",modelValue:s.exeat2,"onUpdate:modelValue":e[4]||(e[4]=l=>s.exeat2=l),label:"2nd exeat"},null,8,["modelValue"]),n(D,{type:"date",id:"term-end","stack-label":"",modelValue:s.termEnd,"onUpdate:modelValue":e[5]||(e[5]=l=>s.termEnd=l),label:"Last day of term"},null,8,["modelValue"]),V(n(Z,{class:"q-ma-md",type:"submit",onClick:i.dateToString,label:"generate saturdays",color:"primary"},null,8,["onClick"]),[[w]])]),_:1})]),_e,v("div",ke,[s.datesNotAvailable?(m(),h(Q,{key:1,bordered:"",separator:"",style:{"max-width":"200px"}},{default:o(()=>[n(C,{header:""},{default:o(()=>[p("Saturdays This Term")]),_:1}),n(S,null,{default:o(()=>[p("No dates have been set for this term yet")]),_:1})]),_:1})):(m(),h(Q,{key:0,bordered:"",separator:""},{default:o(()=>[n(C,{header:""},{default:o(()=>[p("Saturdays This Term")]),_:1}),(m(!0),E(H,null,U(s.stringArray,l=>(m(),h(S,{key:l},{default:o(()=>[n(W,{avatar:""},{default:o(()=>[n($,{name:"today"})]),_:1}),n(W,null,{default:o(()=>[p(j(l),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),n(he,{modelValue:s.formWarning,"onUpdate:modelValue":e[6]||(e[6]=l=>s.formWarning=l),position:"bottom"},{default:o(()=>[n(Y,{class:"bg-negative text-bold text-center text-white",style:{width:"30%"}},{default:o(()=>[n(z,null,{default:o(()=>[Te]),_:1})]),_:1})]),_:1},8,["modelValue"])])):ue("",!0)]),_:1})}var Me=de(ye,[["render",we],["__scopeId","data-v-7e9f0e1d"]]);export{Me as default};
