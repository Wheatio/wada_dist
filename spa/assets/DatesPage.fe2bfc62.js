import{Q,a as D,d as L}from"./use-model-toggle.81454eea.js";import{Q as j}from"./QExpansionItem.68212f34.js";import{a as C}from"./QList.69e56486.js";import{Q as O}from"./QScrollArea.ae520a98.js";import{a as U,Q as Y}from"./QToolbar.64add080.js";import{Q as S}from"./QInput.2b40c3e6.js";import{u as K,a as z,E as G,F as J,g as X,h as Z,z as $,p as ee,aj as te,j as H,a0 as ae,G as se,aK as re,_ as le,s as E,o as m,O as p,P as o,ap as v,T as i,V as g,c as A,Y as R,w,Z as M,W as I,B as oe,Q as ne,X as ie,R as V,ax as de,ay as ue}from"./index.23a141fd.js";import{a as me}from"./focus-manager.d6507951.js";import{a as fe,Q as ce}from"./QCard.9f53c50a.js";import{Q as he}from"./QDialog.0c894dac.js";import{Q as pe}from"./QPage.32d3344f.js";import"./use-dark.477b7fb1.js";import"./QScrollObserver.2f59b851.js";import"./focusout.e6d19d5b.js";var ge=K({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(t,{slots:e,emit:r}){const d=ee(),a=z(null);let n=0;const s=[];function c(l){const b=typeof l=="boolean"?l:t.noErrorFocus!==!0,T=++n,W=(u,f)=>{r("validation"+(u===!0?"Success":"Error"),f)},q=u=>{const f=u.validate();return typeof f.then=="function"?f.then(y=>({valid:y,comp:u}),y=>({valid:!1,comp:u,err:y})):Promise.resolve({valid:f,comp:u})};return(t.greedy===!0?Promise.all(s.map(q)).then(u=>u.filter(f=>f.valid!==!0)):s.reduce((u,f)=>u.then(()=>q(f).then(y=>{if(y.valid===!1)return Promise.reject(y)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return T===n&&W(!0),!0;if(T===n){const{comp:f,err:y}=u[0];if(y!==void 0&&console.error(y),W(!1,f),b===!0){const N=u.find(({comp:B})=>typeof B.focus=="function"&&te(B.$)===!1);N!==void 0&&N.comp.focus()}}return!1})}function x(){n++,s.forEach(l=>{typeof l.resetValidation=="function"&&l.resetValidation()})}function h(l){l!==void 0&&H(l);const b=n+1;c().then(T=>{b===n&&T===!0&&(t.onSubmit!==void 0?r("submit",l):l!==void 0&&l.target!==void 0&&typeof l.target.submit=="function"&&l.target.submit())})}function _(l){l!==void 0&&H(l),r("reset"),ae(()=>{x(),t.autofocus===!0&&t.noResetFocus!==!0&&k()})}function k(){me(()=>{if(a.value===null)return;const l=a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),b=>b.tabIndex>-1);l!=null&&l.focus({preventScroll:!0})})}se(re,{bindComponent(l){s.push(l)},unbindComponent(l){const b=s.indexOf(l);b>-1&&s.splice(b,1)}});let P=!1;return G(()=>{P=!0}),J(()=>{P===!0&&t.autofocus===!0&&k()}),X(()=>{t.autofocus===!0&&k()}),Object.assign(d.proxy,{validate:c,resetValidation:x,submit:h,reset:_,focus:k,getValidationComponents:()=>s}),()=>Z("form",{class:"q-form",ref:a,onSubmit:h,onReset:_},$(e.default))}});const ye={mounted(){let e=new Date().getFullYear();this.years.push(e);for(let r=0;r<3;r++)e++,this.years.push(e)},data(){return{michStart:null,exeat1:null,halfTerm:null,HTWeeks:null,exeat2:null,termEnd:null,saturdays:[],stringArray:[],years:[],term:null,datesNotAvailable:!1,formWarning:!1}},computed:{formValid(){return!!(this.michStart&&this.exeat1&&this.halfTerm&&this.HTWeeks&&this.exeat2&&this.termEnd)},dates(){let t=null,e=null,r=null,d=null,a=null;return this.michStart&&(t=this.michStart.replace(/-/g,"/")),this.exeat1&&(e=this.exeat1.replace(/-/g,"/")),this.halfTerm&&(r=this.halfTerm.replace(/-/g,"/")),this.exeat2&&(d=this.exeat2.replace(/-/g,"/")),this.termEnd&&(a=this.termEnd.replace(/-/g,"/")),[t,e,r,d,a]}},methods:{getSaturdays(){this.saturdays=[];const t=new Date(this.michStart),e=new Date(this.getSaturday(this.exeat1)),r=new Date(this.getSaturday(this.halfTerm)),d=new Date(this.getSaturday(this.exeat2)),a=new Date(this.termEnd);let n=new Date(t);for(n=new Date(this.getSaturday(n));n<a;)this.saturdays.push(new Date(n)),n.setDate(n.getDate()+7);const s=[];let c=this.generateHalfTerm(this.HTWeeks,r);s.push(e);for(let h=0;h<c.length;h++)s.push(c[h]);s.push(d);let x=this.saturdays.filter(h=>!s.find(_=>_.getDate()===h.getDate()));x=x.filter(h=>h.getDate()!==d.getDate()),this.saturdays=x},dateToString(){if(this.formValid){if(this.saturdays.length<2){this.getSaturdays();let t,e=[];for(let r=0;r<this.saturdays.length;r++)t=""+this.saturdays[r].getFullYear()+"-"+(this.saturdays[r].getMonth()+1)+"-"+this.saturdays[r].getDate(),e.push(t);this.stringArray=e,this.term?this.putDatesInDatabase(this.term,this.year,e):alert("Please select a term")}}else this.formWarning=!0},setTerm(t,e){this.term=t,this.year=e,this.getDatesFromStore()},async putDatesInDatabase(t,e,r){console.log("attempting to put dates in database");let d=[];for(let a in r){let n=await fetch(E.getters.getServerURL+"api/v1/public/dates",{method:"POST",body:JSON.stringify({date:r[a],term:t,year:e})});n.ok||console.error("there was an error adding new dates to the database");let s=n.json();console.log(s);let c={date_id:s.id,date:r[a],term:t,year:e};d.push(c)}E.dispatch("addDates",d),console.log("sending dates to the store: ",d),this.getDatesFromStore()},getSaturday(t){t=new Date(t);let e=t.getDay(),r=t.getDate()+(6-e);return new Date(t.setDate(r))},addAWeek(t){let e=new Date(t),r=e.getDate()+7;return new Date(e.setDate(r))},generateHalfTerm(t,e){let r=[],d=new Date(e);r.push(e);for(let a=0;a<t;a++)d=new Date(this.addAWeek(d)),r.push(d);return r},getDatesFromStore(){const t=this.term+this.year;console.log("current term = ",t);const e=E.getters.getDates;console.log("dates.dates = ",e);const r=e.filter(d=>d.term===t);r[0]?(console.log("filteredDates = ",r[0].dates),this.stringArray=r[0].dates,this.datesNotAvailable=!1):this.datesNotAvailable=!0}}},F=t=>(de("data-v-e5395568"),t=t(),ue(),t),be={class:"sidebar col-2",width:"250px"},ve={key:0,class:"q-pa-none col-10"},xe={class:"q-pa-md row"},Se={class:"q-pa-lg",style:{"max-width":"400px"}},De=F(()=>v("div",{class:"text-h6",style:{padding:"none"}},"Select Term Dates",-1)),_e=F(()=>v("div",{class:"q-pa-lg"},null,-1)),ke={class:"q-pa-lg",style:{"max-width":"400px"}},Te=F(()=>v("div",null,"Please complete all the term dates before submitting",-1));function we(t,e,r,d,a,n){return m(),p(pe,{class:"row"},{default:o(()=>[v("div",be,[i(O,{class:"fit"},{default:o(()=>[i(C,{padding:"",class:"menu-list"},{default:o(()=>[i(Q,{header:""},{default:o(()=>[g("Choose Term")]),_:1}),(m(!0),A(M,null,R(a.years,s=>(m(),p(j,{key:s,bordered:"","expand-separator":"",icon:"today",label:s.toString()},{default:o(()=>[w((m(),p(D,{clickable:"",label:"Michaelmas",onClick:c=>n.setTerm("Michaelmas",s)},{default:o(()=>[g("Michaelmas")]),_:2},1032,["onClick"])),[[V]]),w((m(),p(D,{clickable:"",label:"Lent",onClick:c=>n.setTerm("Lent",s)>t.Lent},{default:o(()=>[g("Lent")]),_:2},1032,["onClick"])),[[V]]),w((m(),p(D,{clickable:"",label:"Summer",onClick:c=>n.setTerm("Summer",s)},{default:o(()=>[g("Summer")]),_:2},1032,["onClick"])),[[V]])]),_:2},1032,["label"]))),128))]),_:1})]),_:1})]),a.term?(m(),A("div",ve,[i(Y,{class:"bg-secondary glossy text-white"},{default:o(()=>[a.term?(m(),p(U,{key:0},{default:o(()=>[g(I(a.term)+" "+I(t.year),1)]),_:1})):(m(),p(U,{key:1},{default:o(()=>[g("No term currently selected")]),_:1}))]),_:1}),v("div",xe,[v("div",Se,[i(ge,null,{default:o(()=>[De,i(S,{type:"date",id:"mich-start","fill-mask":"false","stack-label":"",modelValue:a.michStart,"onUpdate:modelValue":e[0]||(e[0]=s=>a.michStart=s),label:"First day of term"},null,8,["modelValue"]),i(S,{type:"date",id:"first-exeat","stack-label":"",modelValue:a.exeat1,"onUpdate:modelValue":e[1]||(e[1]=s=>a.exeat1=s),label:"1st exeat"},null,8,["modelValue"]),i(S,{type:"date",id:"half-term",modelValue:a.halfTerm,"onUpdate:modelValue":e[2]||(e[2]=s=>a.halfTerm=s),"stack-label":"",label:"1st day of half term"},null,8,["modelValue"]),i(S,{type:"number",id:"weeks-iin-half-term",modelValue:a.HTWeeks,"onUpdate:modelValue":e[3]||(e[3]=s=>a.HTWeeks=s),modelModifiers:{number:!0},label:"number of weeks in half term"},null,8,["modelValue"]),i(S,{type:"date",id:"second-exeat","stack-label":"",modelValue:a.exeat2,"onUpdate:modelValue":e[4]||(e[4]=s=>a.exeat2=s),label:"2nd exeat"},null,8,["modelValue"]),i(S,{type:"date",id:"term-end","stack-label":"",modelValue:a.termEnd,"onUpdate:modelValue":e[5]||(e[5]=s=>a.termEnd=s),label:"Last day of term"},null,8,["modelValue"]),w(i(oe,{class:"q-ma-md",type:"submit",onClick:n.dateToString,label:"generate saturdays",color:"primary"},null,8,["onClick"]),[[V]])]),_:1})]),_e,v("div",ke,[a.datesNotAvailable?(m(),p(C,{key:1,bordered:"",separator:"",style:{"max-width":"200px"}},{default:o(()=>[i(Q,{header:""},{default:o(()=>[g("Saturdays This Term")]),_:1}),i(D,null,{default:o(()=>[g("No dates have been set for this term yet")]),_:1})]),_:1})):(m(),p(C,{key:0,bordered:"",separator:""},{default:o(()=>[i(Q,{header:""},{default:o(()=>[g("Saturdays This Term")]),_:1}),(m(!0),A(M,null,R(a.stringArray,s=>(m(),p(D,{key:s},{default:o(()=>[i(L,{avatar:""},{default:o(()=>[i(ne,{name:"today"})]),_:1}),i(L,null,{default:o(()=>[g(I(s),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),i(he,{modelValue:a.formWarning,"onUpdate:modelValue":e[6]||(e[6]=s=>a.formWarning=s),position:"bottom"},{default:o(()=>[i(fe,{class:"bg-negative text-bold text-center text-white",style:{width:"30%"}},{default:o(()=>[i(ce,null,{default:o(()=>[Te]),_:1})]),_:1})]),_:1},8,["modelValue"])])):ie("",!0)]),_:1})}var Re=le(ye,[["render",we],["__scopeId","data-v-e5395568"]]);export{Re as default};
