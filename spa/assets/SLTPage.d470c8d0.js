import{_ as T,o as m,c as _,ap as a,W as V,aw as x,X as U,s as p,S as h,O as g,P as c,Z as b,Y as D,r as H,ax as Q,ay as q,w as v,az as B,T as d,Q as L,B as k,V as N,R as P}from"./index.23a141fd.js";import{a as F,d as I}from"./use-model-toggle.81454eea.js";import{a as j,Q as K}from"./QList.69e56486.js";import{Q as X}from"./QScrollArea.ae520a98.js";import{Q as z}from"./QPage.32d3344f.js";import{B as J}from"./BaseCard.e42d9824.js";import{Q as A}from"./QSelect.b3e0b88c.js";import{Q as S}from"./QInput.2b40c3e6.js";import{a as M,Q as E}from"./QCard.9f53c50a.js";import{Q as W}from"./QCardActions.f11e2357.js";import{Q as R}from"./QDialog.0c894dac.js";import{C}from"./ClosePopup.cd3d0578.js";import"./use-dark.477b7fb1.js";import"./QScrollObserver.2f59b851.js";import"./focusout.e6d19d5b.js";import"./focus-manager.d6507951.js";import"./QChip.c1a39239.js";import"./rtl.f617a0de.js";const Z={props:{modelValue:{},label:{required:!0,type:Number},member:{required:!1},isEditable:{type:Boolean,required:!0}},emits:["update:modelValue","update-array"],methods:{submitData(){this.$emit("update:modelValue",this.$refs.staffname.value),this.$emit("update-array",this.member,this.$refs.staffname.value)},warnMessage(){this.isWarning=!0},clickOK(){this.isWarning=!1,document.getElementById(this.member).focus()}},data(){return{isWarning:!1}}},G={for:"staffname"},$=["id"],ee={key:1},te=["id","value"];function le(l,e,s,u,t,n){return m(),_("div",null,[a("label",G,V(s.label),1),s.member?s.member&&!s.isEditable?(m(),_("span",ee,V(s.member),1)):s.member&&s.isEditable?(m(),_("input",{key:2,id:s.member,value:s.member,ref:"staffname",onClick:e[2]||(e[2]=(...f)=>n.warnMessage&&n.warnMessage(...f)),onBlur:e[3]||(e[3]=(...f)=>n.submitData&&n.submitData(...f)),onKeyup:e[4]||(e[4]=x(f=>f.target.blur(),["enter"]))},null,40,te)):U("",!0):(m(),_("input",{key:0,id:s.member,ref:"staffname",onBlur:e[0]||(e[0]=(...f)=>n.submitData&&n.submitData(...f)),onKeyup:e[1]||(e[1]=x(f=>f.target.blur(),["enter"]))},null,40,$))])}var O=T(Z,[["render",le],["__scopeId","data-v-317c3ab4"]]);const ae={mounted(){this.staffArray=this.staff},data(){return{staffArray:[],isEditable:!1}},components:{SltStaffInput:O,BaseCard:J},props:{id:{type:String,required:!0},yeargroup:{type:String,required:!0},title:{type:String,required:!0},location:{type:String,required:!0},staff:{type:Array,required:!0},date:{type:String,required:!0},date_id:{required:!0}},methods:{async updateStaff(l,e){console.log("prev ",l,"new ",e);const s=p.getters.getServerURL;console.log("this.id = ",this.id,l);let u=await fetch(s+`api/v1/public/loading/${l}`);if(!u.ok)throw"Error fetching the events that "+initials+" is signed up for. "+u.message;let t=await u.json();console.log("",t);const n=t.filter(w=>w.event_id===this.id),f=n[0].loading_id;if(console.log("this.id = ",this.id,".  filteredData = ",n,"loadingId = ",f),e===""){console.log("newInitials is blank ");let Y=await(await fetch(s+`api/v1/public/loading/${f}`,{method:"DELETE"})).json();console.log(Y)}let r=await(await fetch(s+`api/v1/public/staff/${e}/get_by_initials`)).json();console.log("staffId = ",r.staff_id);let i=await fetch(s+`api/v1/public/loading/${f}`,{method:"PATCH",body:JSON.stringify({staff_id:r.staff_id})});if(!i.ok)throw"Error altering the loading event "+f+": "+i.message;console.log("successfully patched ",f," and changed intials from ",l," to ",e)},addStaff(){this.staffArray.push(0)},removeStaff(){this.staffArray.splice(this.staffArray.length-1,1)},removeFromDatabase(){console.log("Editable Date Card is deleting ",this.id," from the database. Title: ",this.title),p.dispatch("removeEvent",this.id)}}},ne=l=>(Q("data-v-6503dd7f"),l=l(),q(),l),se=["value"],oe=ne(()=>a("datalist",{id:"event"},[a("option",{value:"Shell"},"Shell"),a("option",{value:"Remove"},"Remove"),a("option",{value:"Hundred"},"Hundred"),a("option",{value:"6th Form"},"6th Form")],-1)),re=["id","value"],de=["id","value"],ie={class:"infopanel"},ue={class:"button-holder"};function fe(l,e,s,u,t,n){const f=h("slt-staff-input"),o=h("base-card");return m(),g(o,{styleType:s.yeargroup},{default:c(()=>[a("button",{class:"cancel-button",onClick:e[0]||(e[0]=(...r)=>n.removeFromDatabase&&n.removeFromDatabase(...r))},"X"),a("header",null,[a("p",null,V(s.date),1),a("p",null,"date:"+V(s.date_id)+" id:"+V(s.id),1),a("input",{list:"event",ref:"yeargroup",value:s.yeargroup,onChange:e[1]||(e[1]=(...r)=>n.updateStaff&&n.updateStaff(...r))},null,40,se),oe,a("input",{class:"input-h2",type:"text",id:s.title,value:s.title,ref:"title",onBlur:e[2]||(e[2]=(...r)=>n.updateStaff&&n.updateStaff(...r))},null,40,re),a("input",{class:"input-h3",type:"text",id:s.location,value:s.location,ref:"location",onBlur:e[3]||(e[3]=(...r)=>n.updateStaff&&n.updateStaff(...r))},null,40,de)]),a("div",ie,[(m(!0),_(b,null,D(t.staffArray,(r,i)=>(m(),g(f,{key:r,member:r,label:i+1,modelValue:t.staffArray[i],"onUpdate:modelValue":w=>t.staffArray[i]=w,isEditable:!0,onUpdateArray:n.updateStaff},null,8,["member","label","modelValue","onUpdate:modelValue","onUpdateArray"]))),128))]),a("div",ue,[H(l.$slots,"default",{onClick:e[4]||(e[4]=(...r)=>n.updateStaff&&n.updateStaff(...r))},void 0,!0),a("button",{onClick:e[5]||(e[5]=(...r)=>n.addStaff&&n.addStaff(...r))},"Add Staff"),a("button",{onClick:e[6]||(e[6]=(...r)=>n.removeStaff&&n.removeStaff(...r))},"Remove Staff")])]),_:3},8,["styleType"])}var ce=T(ae,[["render",fe],["__scopeId","data-v-6503dd7f"]]);const me={mounted(){this.staffArray=Array.from(this.staff)},computed:{currentTerm(){return p.getters.getCurrentTerm}},data(){return{staffArray:[],isEditable:!1,year:"",location:"",title:""}},components:{SltStaffInput:O},props:{staff:{type:Array,required:!0},date_id:{type:Number,required:!0}},methods:{addEvent(){console.log("date_id = ",this.date_id);const l={date_id:this.date_id,yeargroup:this.year,title:this.title,location:this.location,staff:this.staffArray};p.dispatch("addEvent",l)},addStaff(){this.staffArray.push(0)},removeStaff(){this.staffArray.splice(this.staffArray.length-1,1)}}},pe=l=>(Q("data-v-e2c11120"),l=l(),q(),l),_e=pe(()=>a("datalist",{id:"event"},[a("option",{value:"Shell"},"Shell"),a("option",{value:"Remove"},"Remove"),a("option",{value:"Hundred"},"Hundred"),a("option",{value:"6th Form"},"6th Form")],-1)),ve={class:"infopanel"},ge={class:"button-holder"};function he(l,e,s,u,t,n){const f=h("slt-staff-input"),o=h("base-card");return m(),g(o,{styleType:t.year},{default:c(()=>[a("header",null,[v(a("input",{list:"event",ref:"yeargroup",placeholder:"Year","onUpdate:modelValue":e[0]||(e[0]=r=>t.year=r)},null,512),[[B,t.year]]),_e,v(a("input",{class:"input-h2",type:"text",id:"title",placeholder:"Title",ref:"title","onUpdate:modelValue":e[1]||(e[1]=r=>t.title=r)},null,512),[[B,t.title]]),v(a("input",{class:"input-h3",type:"text",id:"location",placeholder:"Location",ref:"location","onUpdate:modelValue":e[2]||(e[2]=r=>t.location=r)},null,512),[[B,t.location]])]),a("div",ve,[(m(!0),_(b,null,D(t.staffArray,(r,i)=>(m(),g(f,{key:r,member:r,label:i+1,modelValue:t.staffArray[i],"onUpdate:modelValue":w=>t.staffArray[i]=w,isEditable:!0},null,8,["member","label","modelValue","onUpdate:modelValue"]))),128))]),a("div",ge,[a("button",{onClick:e[3]||(e[3]=(...r)=>n.addEvent&&n.addEvent(...r))},"Add Event"),a("button",{onClick:e[4]||(e[4]=(...r)=>n.addStaff&&n.addStaff(...r))},"Add Staff"),a("button",{onClick:e[5]||(e[5]=(...r)=>n.removeStaff&&n.removeStaff(...r))},"Remove Staff")])]),_:1},8,["styleType"])}var ye=T(me,[["render",he],["__scopeId","data-v-e2c11120"]]);const be={created(){console.log("mounting array"),this.newEvents=Array.from(this.events),console.log(this.newEvents),this.getStaffByEventID()},computed:{events(){const l=p.getters.getCurrentTerm;return p.getters.getEvents.filter(u=>u.term===l.term&&u.year===l.year)},dates(){const l=p.getters.getFullDates,e=p.getters.getCurrentTerm,s=l.filter(t=>t.term===e.term&&t.year===e.year),u=s.map(t=>t.date);return s.length>0?u:[0,0,0]},currentTerm(){return p.getters.getCurrentTerm}},data(){return{newEvents:[],yeargroupOptions:["Shell","Remove","Hundred","6th Form"],newDate:null,newDateId:null,newTitle:null,newLocation:null,newYeargroup:null,staffNum:null,newStaff:[null,null,null,null],valRules:[l=>!!l||"Required"],confirm:!1,allowSubmit:!1,missingData:!1,deleteId:null,deletePopup:!1,dateOptions:[],staffIsLoading:!1,staffMap:[]}},watch:{events(){this.newEvents=this.events},newDate(l){const s=p.getters.getFullDates.filter(u=>u.date===l)[0].date_id;this.newDateId=s,console.log(this.newDateId)}},methods:{deleteEvent(){console.log("delete triggered on ",this.deleteId),p.dispatch("removeEvent",this.deleteId),this.deleteId=null,this.newEvents=p.getters.getEvents},setValue(l){console.log("altering ",l),console.log(this.newEvents)},submit(){this.confirm=!0},addEvent(){if(this.newDate&&this.newTitle&&this.newLocation&&this.newYeargroup&&this.staffNum){const l={year_group:this.newYeargroup,event_title:this.newTitle,location:this.newLocation,staff_no:this.staffNum,date_id:this.newDateId};p.dispatch("addEvent",l)}},addStaff(){this.newStaff.push(null)},removeStaff(){this.newStaff.splice(this.newStaff.length-1,1)},triggerDelete(l){this.deleteId=l,this.deletePopup=!0},testMethod(){const l=p.getters.getCurrentTerm;console.log("current term = ",l);const e=p.getters.getEvents;console.log("allEvents = ",e);const s=e.filter(u=>u.term===l);return console.log("currentEvents = ",s),s},async getStaffByEventID(){console.log("getting staff by event ID...");try{this.staffIsLoading=!0;const l=this.events;console.log("when loading staff, events = ",l);for(const e of l){console.log("getting staff for event ",e.event_id);let s=await fetch(p.getters.getServerURL+`api/v1/public/events/${e.event_id}/loading`);if(!s.ok)throw"Could not get staff loading from database for event "+e.id+" message: "+s.message;let u=await s.json();console.log("server response = ",u);const t=u.map(o=>o.initials);this.staffMap[e.event_id]=t,console.log("staffMap = ",this.staffMap);const n=e.staff_no;console.log("staffNo = ",n,"staffMap[this one].length = ",this.staffMap[e.event_id].length,"difference = ",n-this.staffMap[e.event_id].length);const f=n-this.staffMap[e.event_id].length;for(let o=0;o<f;o++)this.staffMap[e.event_id].push(null)}this.staffIsLoading=!1}catch(l){console.error("loading the staff loading array was unsuccessful: ",l)}}}},y=l=>(Q("data-v-00bae584"),l=l(),q(),l),we={class:"q-table",id:"events"},Se=y(()=>a("tr",null,[a("th",null,"Date"),a("th",null,"Year"),a("th",null,"Event"),a("th",null,"Location"),a("th",{colspan:"4"},"Staff")],-1)),Ee=["colspan"],Ve=["onClick"],De=y(()=>a("tr",null,[a("td",{colspan:"9"})],-1)),Te={colspan:4},ke=y(()=>a("div",{class:"text-h6"},"Create Event",-1)),Ce=y(()=>a("div",{class:"q-pt-none"},"Are you sure you want to create this event?",-1)),Ie=y(()=>a("div",{class:"text-h6"},"Warning",-1)),Ae=y(()=>a("div",{class:"q-pt-none"}," All fields must be filled in order to add an event. ",-1)),Ue=y(()=>a("div",{class:"text-h6"},"Delete",-1)),Le=y(()=>a("div",{class:"q-pt-none"},"Are you sure you want to delete this event?",-1));function Be(l,e,s,u,t,n){const f=h("q-card-action");return m(),_(b,null,[a("table",we,[Se,(m(!0),_(b,null,D(t.newEvents,(o,r)=>(m(),_("tr",{key:o.event_id},[a("td",null,[d(A,{options:n.dates,placeholder:o.date,dense:"",ref_for:!0,ref:o.id+"date",modelValue:t.newEvents[r].date,"onUpdate:modelValue":i=>t.newEvents[r].date=i,onBlur:i=>n.setValue(o.event_id)},null,8,["options","placeholder","modelValue","onUpdate:modelValue","onBlur"])]),a("td",null,[d(A,{options:t.yeargroupOptions,modelValue:t.newEvents[r].year_group,"onUpdate:modelValue":i=>t.newEvents[r].year_group=i,placeholder:o.year_group,style:{width:"5rem"},dense:"",onBlur:i=>n.setValue(o.event_id)},null,8,["options","modelValue","onUpdate:modelValue","placeholder","onBlur"])]),a("td",null,[d(S,{type:"text",placeholder:o.event_title,dense:"",modelValue:t.newEvents[r].event_title,"onUpdate:modelValue":i=>t.newEvents[r].event_title=i,onBlur:i=>n.setValue(o.event_id)},null,8,["placeholder","modelValue","onUpdate:modelValue","onBlur"])]),a("td",null,[d(S,{type:"text",placeholder:o.location,dense:"",modelValue:t.newEvents[r].location,"onUpdate:modelValue":i=>t.newEvents[r].location=i,onBlur:i=>n.setValue(o.event_id)},null,8,["placeholder","modelValue","onUpdate:modelValue","onBlur"])]),(m(!0),_(b,null,D(t.staffMap[o.event_id],i=>(m(),_("td",{key:o.event_id+i,colspan:4/t.staffMap[o.event_id].length},[d(S,{placeholder:i,style:{width:"2rem"},dense:""},null,8,["placeholder"])],8,Ee))),128)),a("td",{onClick:i=>n.triggerDelete(o.event_id)},[d(L,{name:"delete"})],8,Ve)]))),128)),De,a("tr",null,[a("td",null,[d(A,{options:n.dates,modelValue:t.newDate,"onUpdate:modelValue":e[0]||(e[0]=o=>t.newDate=o),dense:"",rules:t.valRules},null,8,["options","modelValue","rules"])]),a("td",null,[d(A,{options:t.yeargroupOptions,modelValue:t.newYeargroup,"onUpdate:modelValue":e[1]||(e[1]=o=>t.newYeargroup=o),dense:"",rules:t.valRules},null,8,["options","modelValue","rules"])]),a("td",null,[d(S,{label:"Title",modelValue:t.newTitle,"onUpdate:modelValue":e[2]||(e[2]=o=>t.newTitle=o),dense:"",rules:t.valRules},null,8,["modelValue","rules"])]),a("td",null,[d(S,{label:"Location",modelValue:t.newLocation,"onUpdate:modelValue":e[3]||(e[3]=o=>t.newLocation=o),dense:"",rules:t.valRules},null,8,["modelValue","rules"])]),a("td",Te,[d(S,{type:"number",label:"Number of Staff",modelValue:t.staffNum,"onUpdate:modelValue":e[4]||(e[4]=o=>t.staffNum=o),modelModifiers:{number:!0},dense:"",rules:t.valRules},null,8,["modelValue","rules"])]),a("td",null,[d(L,{onClick:n.addEvent,name:"add"},null,8,["onClick"])])])]),d(R,{modelValue:t.confirm,"onUpdate:modelValue":e[5]||(e[5]=o=>t.confirm=o)},{default:c(()=>[d(M,null,{default:c(()=>[d(E,null,{default:c(()=>[ke]),_:1}),d(E,null,{default:c(()=>[Ce]),_:1}),d(W,null,{default:c(()=>[v(d(k,{flat:"",label:"OK",color:"positive",onClick:n.addEvent},null,8,["onClick"]),[[C]]),v(d(k,{flat:"",label:"cancel",color:"negative"},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d(R,{modelValue:t.missingData,"onUpdate:modelValue":e[6]||(e[6]=o=>t.missingData=o)},{default:c(()=>[d(M,null,{default:c(()=>[d(E,null,{default:c(()=>[Ie]),_:1}),d(E,null,{default:c(()=>[Ae]),_:1}),d(W,null,{default:c(()=>[v(d(k,{flat:"",label:"ok",color:"primary"},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d(R,{modelValue:t.deletePopup,"onUpdate:modelValue":e[8]||(e[8]=o=>t.deletePopup=o)},{default:c(()=>[d(M,null,{default:c(()=>[d(E,null,{default:c(()=>[Ue]),_:1}),d(E,null,{default:c(()=>[Le]),_:1}),d(f,null,{default:c(()=>[v(d(k,{flat:"",label:"ok",color:"positive",onClick:e[7]||(e[7]=o=>n.deleteEvent(this.deleteId))},null,512),[[C]]),v(d(k,{flat:"",label:"cancel",color:"negative"},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Me=T(be,[["render",Be],["__scopeId","data-v-00bae584"]]);const Re={components:{EditableDutyCard:ce,NewEventCard:ye,MagicTable:Me},props:{date_id:{type:Number,required:!0}},data(){return{newStaff:[0,0],staffMap:[],isLoading:!1}},computed:{eventArray(){return p.getters.getEvents},thisDateEvents(){let l=this.eventArray.filter(e=>e.date_id===this.date_id);return console.log("the events array in editabledatepage is: ",l),l}},mounted(){console.log("EditableDatePage says: on mounting ",this.dateId),this.getStaffByEventID()},methods:{async getStaffByEventID(){console.log("getting staff by event ID...");try{this.isLoading=!0;const l=this.eventArray;console.log("when loading staff, events = ",l);for(const e of l){console.log("getting staff for event ",e.event_id);let s=await fetch(p.getters.getServerURL+`api/v1/public/events/${e.event_id}/loading`);if(!s.ok)throw"Could not get staff loading from database for event "+e.id+" message: "+s.message;let u=await s.json();console.log("server response = ",u);const t=u.map(n=>n.initials);this.staffMap[e.event_id]=t,console.log("staffMap = ",this.staffMap)}this.isLoading=!1}catch(l){console.error("loading the staff loading array was unsuccessful: ",l)}}}},Qe={key:0,class:"datepage"};function qe(l,e,s,u,t,n){const f=h("new-event-card"),o=h("editable-duty-card"),r=h("magic-table");return t.isLoading?U("",!0):(m(),_("div",Qe,[s.date_id!=="Whole Term"?(m(),g(f,{key:0,staff:t.newStaff,date:l.date,date_id:s.date_id},null,8,["staff","date","date_id"])):U("",!0),(m(!0),_(b,null,D(n.thisDateEvents,i=>(m(),g(o,{id:i.event_id,key:i.title+i.date,yeargroup:i.year_group,title:i.event_title,location:i.location,staff:t.staffMap[i.event_id],date_id:i.date_id},null,8,["id","yeargroup","title","location","staff","date_id"]))),128)),s.date_id==="Whole Term"?(m(),g(r,{key:1})):U("",!0)]))}var xe=T(Re,[["render",qe],["__scopeId","data-v-061df1d1"]]);const Ne={components:{EditableDatePage:xe},data(){return{selectedTab:"Whole Term",rightDrawerState:!0,dateIDsAreLoaded:!1}},computed:{dates(){const l=p.getters.getFullDates,e=p.getters.getCurrentTerm;console.log("SLTPage. allDates = ",l,"currentTerm=",e);const s=l.filter(u=>u.term===e.term&&u.year===e.year);return s.length>0?(console.log("SLTPage says dates = ",s),s):[]}},methods:{selectTab(l){this.selectedTab=l},displayDate(l){let e=new Date(l);return e.getDate()+"/"+(e.getMonth()+1)}}},Pe={class:"sidebar col-2 desktop-only"};function Fe(l,e,s,u,t,n){const f=h("editable-date-page");return m(),g(z,{class:"row no-wrap desktop-only"},{default:c(()=>[a("div",Pe,[d(X,{class:"fit"},{default:c(()=>[d(j,{padding:"",class:"menu-list"},{default:c(()=>[v((m(),g(F,{key:"Whole Term",clickable:"",active:t.selectedTab==="Whole Term",onClick:e[0]||(e[0]=o=>n.selectTab("Whole Term"))},{default:c(()=>[d(I,{avatar:""},{default:c(()=>[d(L,{name:"calendar_month"})]),_:1}),d(K),d(I,null,{default:c(()=>[N(" Whole Term")]),_:1})]),_:1},8,["active"])),[[P]]),(m(!0),_(b,null,D(n.dates,o=>v((m(),g(F,{key:o.date_id,clickable:"",active:t.selectedTab===o.date_id,onClick:r=>n.selectTab(o.date_id)},{default:c(()=>[d(I,{avatar:""},{default:c(()=>[d(L,{name:"event"})]),_:1}),d(I,null,{default:c(()=>[N(V(n.displayDate(o.date)),1)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[P]])),128))]),_:1})]),_:1})]),d(f,{date_id:t.selectedTab},null,8,["date_id"])]),_:1})}var ot=T(Ne,[["render",Fe],["__scopeId","data-v-26bc9858"]]);export{ot as default};
