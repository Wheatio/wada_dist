import{Q as V}from"./QPage.d90d5951.js";import{h as b,u as E,_ as y,s as m,o as g,P as h,S as a,at as f,U as l,V as D,B as v,T}from"./index.d8108594.js";import{Q as p}from"./QInput.82dc4243.js";import{Q as c}from"./QSelect.f70a0a07.js";import{Q as u,a as _,b as U}from"./QTable.164d1b7a.js";import{d as w}from"./helpers.4e16fb27.js";import"./uid.afa002be.js";import"./focus-manager.d6507951.js";import"./QChip.599eb0a7.js";import"./use-model-toggle.c12189cd.js";import"./rtl.dd9d6a59.js";import"./focusout.64402b39.js";import"./format.9061e598.js";import"./QList.c75c973b.js";const B=b("div",{class:"q-space"});var F=E({name:"QSpace",setup(){return()=>B}});const x={data(){return{selection:[],pagination:{rowsPerPage:0},newEvent:{year_group:null,event_title:null,location:null,staff_no:4,date_id:null,counts_as:1,term:null,year:null},columns:[{name:"date",label:"Date",field:"date",align:"left",sortable:!0},{name:"yearGroup",label:"Year Group",field:"year_group",align:"left",sortable:!0},{name:"event",label:"Event Name",field:"event_title",align:"left",sortable:!0},{name:"location",label:"Location",field:"location",align:"left"},{name:"staff",label:"Staff",field:"staff_no",align:"left"},{name:"countsAs",label:"Worth # Duties",field:"counts_as",align:"center"},{name:"actions",label:"actions",label:"Actions",field:"",align:"center"}],yearOptions:["Shell","Remove","Hundred","6th Form"],textFilter:"",dateFilter:null}},computed:{rows(){const t=m.getters.getEvents.filter(s=>s.term===this.currentTerm.term&&s.year===this.currentTerm.year);let r=Array.from(t);if(this.dateFilter){r=r.filter(o=>o.date_id===this.dateFilter);const s={Shell:0,Remove:1,Hundred:2,"6th Form":3};r.sort((o,d)=>s[o.year_group]-s[d.year_group])}return r=r.filter(s=>s.event_title.toLowerCase().includes(this.textFilter.toLowerCase())),r},dates(){const n=m.getters.getFullDates,t=m.getters.getCurrentTerm,r=n.filter(s=>s.term===t.term&&s.year===t.year);return console.log("filteredDates",r),r},dateOptions(){const t=this.dates.filter(r=>r.date_type==="term").map(({date_id:r,date:s})=>({label:w(s),value:r}));return console.log(t),t},dateFilterOptions(){const n=this.dateOptions;return n.unshift({label:"All",value:null}),n},displayDateFromId(n){return m.getters.getFullDates.find(s=>s.date_id===n).date},currentTerm(){return m.getters.getCurrentTerm}},watch:{"store.getters.getEvents":function(){$this.forceUpdate()},dateFilter(n){this.newEvent.date_id=n}},methods:{formatDate(n){return w(n)},updateEvents(n){m.dispatch("updateEvents",this.rows[n])},addRow(){if(!this.newEvent.date_id||!this.newEvent.location||!this.newEvent.event_title||!this.newEvent.year_group){this.$q.notify({color:"red",position:"center",message:"There is missing data from your new event. New event not created.",icon:"warning"});return}m.dispatch("addEvent",{...this.newEvent,year:this.currentTerm.year,term:this.currentTerm.term}),this.rows.unshift(this.newEvent),this.newEvent={year_group:null,event_title:null,location:null,staff_no:4,date_id:this.newEvent.date_id,counts_as:1}},deleteEvent(n){console.log("deleting ",n),m.dispatch("deleteEvent",n)},reallyDelete(n,t){console.log("reallyDelete"),this.$q.notify({position:"center",color:"red",message:"Really delete "+t+"?",icon:"warning",timeout:0,actions:[{label:"ok",handler:()=>{this.deleteEvent(n)},color:"white"},{label:"cancel",color:"white",handler:()=>{}}]})}}},k=f("div",{class:"col-3 q-table__title"},"Events This Term",-1),Q={class:"col-5"},C={class:"col-2"};function S(n,t,r,s,o,d){return g(),h(U,{selected:o.selection,"onUpdate:selected":t[8]||(t[8]=e=>o.selection=e),style:{"max-height":"80vh"},rows:d.rows,columns:o.columns,"row-key":e=>e.event_id,pagination:o.pagination,"virtual-scroll":""},{top:a(()=>[k,f("div",Q,[l(p,{modelValue:o.textFilter,"onUpdate:modelValue":t[0]||(t[0]=e=>o.textFilter=e),label:"Filter by event name",outlined:"",rounded:"",dense:""},{append:a(()=>[l(D,{icon:"search",size:"lg"})]),_:1},8,["modelValue"])]),l(F),f("div",C,[l(c,{modelValue:o.dateFilter,"onUpdate:modelValue":t[1]||(t[1]=e=>o.dateFilter=e),label:"filter by date",outlined:"",rounded:"",dense:"","emit-value":"","map-options":"",options:d.dateFilterOptions},null,8,["modelValue","options"])])]),"top-row":a(()=>[l(_,{class:"bg-blue-2"},{default:a(()=>[l(u,null,{default:a(()=>[l(c,{modelValue:o.newEvent.date_id,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newEvent.date_id=e),options:d.dateOptions,label:"Date","emit-value":"","map-options":"",dense:""},null,8,["modelValue","options"])]),_:1}),l(u,null,{default:a(()=>[l(c,{modelValue:o.newEvent.year_group,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newEvent.year_group=e),options:o.yearOptions,label:"Year Group",placeholder:"Year Group",dense:""},null,8,["modelValue","options"])]),_:1}),l(u,null,{default:a(()=>[l(p,{modelValue:o.newEvent.event_title,"onUpdate:modelValue":t[4]||(t[4]=e=>o.newEvent.event_title=e),placeholder:"New Event Name",dense:""},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{modelValue:o.newEvent.location,"onUpdate:modelValue":t[5]||(t[5]=e=>o.newEvent.location=e),placeholder:"Location",dense:"",style:{width:"130px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{modelValue:o.newEvent.staff_no,"onUpdate:modelValue":t[6]||(t[6]=e=>o.newEvent.staff_no=e),type:"number",dense:""},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{modelValue:o.newEvent.counts_as,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newEvent.counts_as=e),modelModifiers:{number:!0},type:"number",dense:""},null,8,["modelValue"])]),_:1}),l(u,{class:"text-center"},{default:a(()=>[l(v,{round:"",flat:"",size:"sm",icon:"add",class:"bg-primary text-white",onClick:d.addRow},null,8,["onClick"])]),_:1})]),_:1})]),body:a(e=>[l(_,{props:e},{default:a(()=>[l(u,{key:"date",props:e},{default:a(()=>[l(c,{modelValue:e.row.date_id,"onUpdate:modelValue":i=>e.row.date_id=i,options:d.dateOptions,"emit-value":"","map-options":"",dense:"",borderless:"",onBlur:i=>d.updateEvents(e.rowIndex)},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),_:2},1032,["props"]),l(u,{key:"yearGroup",props:e},{default:a(()=>[l(c,{modelValue:e.row.year_group,"onUpdate:modelValue":i=>e.row.year_group=i,options:o.yearOptions,borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),_:2},1032,["props"]),l(u,{key:"event",props:e,style:{width:"300px"}},{default:a(()=>[l(p,{modelValue:e.row.event_title,"onUpdate:modelValue":i=>e.row.event_title=i,dense:"",borderless:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),l(u,{key:"location",props:e},{default:a(()=>[l(p,{modelValue:e.row.location,"onUpdate:modelValue":i=>e.row.location=i,dense:"",borderless:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),l(u,{key:"staff",props:e,style:{width:"60px"}},{default:a(()=>[l(p,{modelValue:e.row.staff_no,"onUpdate:modelValue":i=>e.row.staff_no=i,type:"number",borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props"]),l(u,{key:"countsAs",props:e,style:{width:"50px"},onBlur:d.updateEvents},{default:a(()=>[l(p,{modelValue:e.row.counts_as,"onUpdate:modelValue":i=>e.row.counts_as=i,type:"number",borderless:"",dense:"",onBlur:d.updateEvents},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["props","onBlur"]),l(u,{key:"actions",props:e},{default:a(()=>[l(v,{icon:"delete",class:"text-grey-7",flat:"",dense:"",size:"sm",onClick:i=>d.reallyDelete(e.row.event_id,e.row.event_title)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["selected","rows","columns","row-key","pagination"])}var O=y(x,[["render",S]]);const A={components:{EventsTable:O},data(){return{selectedTab:"Whole Term",rightDrawerState:!0,dateIDsAreLoaded:!1}},computed:{dates(){const n=m.getters.getFullDates,t=m.getters.getCurrentTerm,r=n.filter(s=>s.term===t.term&&s.year===t.year);return r.length>0?r:[]}},methods:{selectTab(n){this.selectedTab=n},displayDate(n){let t=new Date(n);return t.getDate()+"/"+(t.getMonth()+1)}}};function L(n,t,r,s,o,d){const e=T("events-table");return g(),h(V,null,{default:a(()=>[l(e)]),_:1})}var X=y(A,[["render",L],["__scopeId","data-v-19040677"]]);export{X as default};
