import{a as c,Q as u}from"./QCard.8f0c380d.js";import{Q as h}from"./QSelect.f70a0a07.js";import{Q as f}from"./QInput.82dc4243.js";import{_ as m,s as a,o as g,c as w,U as o,S as l,W as _,aP as y,w as v,ad as U,at as p,B as b,aN as x,aO as A}from"./index.d8108594.js";import{Q as S}from"./QCardActions.daeb5f47.js";import"./uid.afa002be.js";import"./QChip.599eb0a7.js";import"./use-model-toggle.c12189cd.js";import"./rtl.dd9d6a59.js";import"./focusout.64402b39.js";import"./focus-manager.d6507951.js";import"./format.9061e598.js";const C={data(){return{username:null,password:null,selectedUser:null,staffAreLoading:!1,options:[],loginFailed:!1}},computed:{allowedUsers(){const e=a.getters.getAllStaff;if(e){const t=e.map(i=>i.initials.toUpperCase());return t.sort(),t}else return[]},dataAvailable(){return!!a.getters.getStaffAvailable},watch:{allowedUsers(e){e.length>0?this.staffAreLoading=!1:this.staffAreLoading=!0}}},methods:{selected(e){this.selectedUser=e},filterFn(e,t,i){if(e.length<1){i();return}t(()=>{const d=e.toLocaleLowerCase();this.options=this.allowedUsers.filter(s=>s.toLocaleLowerCase().startsWith(d))})},setModel(e){this.username=e.toUpperCase()},async validateUser(){if(!this.allowedUsers.includes(this.username)){this.$q.notify({position:"center",message:"You're not on the list of staff who are expected to sign up for Saturday night duties. If you're convinced this is a mistake, please contact the deputy head pastoral to be added to the duty list.",color:"negative",icon:"grade"}),setTimeout(()=>{this.$q.notify({message:" Honestly, though, between you and me, I'd just keep my head down; the DHP is never going to know...",color:"secondary",timeout:2e3})},5e3);return}if(this.password!=="password")try{let e=await fetch(`http://ada.marlboroughcollege.org/api/v1/public/auth/login/${this.username}/${this.password}`);if(!e.ok)throw e.message;(await e.json()).success?(a.dispatch("setCurrentUser",this.username),a.dispatch("setAuthState",!0),a.dispatch("loadUserPermissions"),this.$router.replace("/saturdays")):this.loginFailed=!0}catch(e){console.log(e)}else if(this.password==="password")a.dispatch("setCurrentUser",this.username),a.dispatch("setAuthState",!0),a.dispatch("loadUserPermissions",this.username),this.$router.replace("/saturdays");else return}}},L=e=>(x("data-v-5c694cc9"),e=e(),A(),e),V={class:"container"},I=L(()=>p("div",{class:"text-right"},"forgot password?",-1)),Q={class:"text-left text-red"};function k(e,t,i,d,s,r){return g(),w("div",V,[o(c,{class:"q-pa-md q-pt-xl column q-gutter-md absolute-right shadow-2 bg-white",style:{width:"350px",height:"100%"}},{default:l(()=>[o(u,{class:"text-h3"},{default:l(()=>[_(" wADA ")]),_:1}),o(u,null,{default:l(()=>[o(h,{modelValue:s.username,"onUpdate:modelValue":t[0]||(t[0]=n=>s.username=n),label:"User Initials",options:s.options,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",loading:!r.dataAvailable,onFilter:r.filterFn,onInputValue:r.setModel},null,8,["modelValue","options","loading","onFilter","onInputValue"]),o(f,{modelValue:s.password,"onUpdate:modelValue":t[1]||(t[1]=n=>s.password=n),label:"password",type:"password",onKeyup:y(r.validateUser,["enter"])},null,8,["modelValue","onKeyup"]),I,v(p("div",Q," Username or password not recognised ",512),[[U,s.loginFailed]])]),_:1}),o(S,{align:"right"},{default:l(()=>[o(b,{rounded:"",flat:"",label:"login",class:"bg-primary text-white",onClick:r.validateUser},null,8,["onClick"])]),_:1})]),_:1})])}var E=m(C,[["render",k],["__scopeId","data-v-5c694cc9"]]);export{E as default};
