import{a as c,Q as u}from"./QCard.9f53c50a.js";import{Q as h}from"./QSelect.b3e0b88c.js";import{Q as g}from"./QInput.2b40c3e6.js";import{_ as f,s as o,o as m,c as w,T as s,P as i,V as _,aw as y,w as v,a3 as U,ap as p,B as x,ax as b,ay as A}from"./index.23a141fd.js";import{Q as C}from"./QCardActions.f11e2357.js";import"./use-dark.477b7fb1.js";import"./QChip.c1a39239.js";import"./use-model-toggle.81454eea.js";import"./rtl.f617a0de.js";import"./focusout.e6d19d5b.js";import"./focus-manager.d6507951.js";import"./QDialog.0c894dac.js";const S={data(){return{username:null,password:null,selectedUser:null,staffAreLoading:!1,options:[],loginFailed:!1}},computed:{allowedUsers(){const e=o.getters.getAllStaff;if(e){const t=e.map(l=>l.initials.toUpperCase());return t.sort(),console.log(t),t}else return[]},dataAvailable(){return!!o.getters.getStaffAvailable},watch:{allowedUsers(e){e.length>0?this.staffAreLoading=!1:this.staffAreLoading=!0},username(){console.log(this.username)},password(){console.log(this.password)}}},methods:{selected(e){this.selectedUser=e},filterFn(e,t){t(()=>{const l=e.toLocaleLowerCase();this.options=this.allowedUsers.filter(d=>d.toLocaleLowerCase().startsWith(l))})},setModel(e){this.username=e.toUpperCase()},async validateUser(){if(!this.allowedUsers.includes(this.username)){this.$q.notify({position:"center",message:"You're not on the list of staff who are expected to sign up for Saturday night duties. If you're convinced this is a mistake, please contact the deputy head pastoral to be added to the duty list.",color:"negative",icon:"grade"}),setTimeout(()=>{this.$q.notify({message:" Honestly, though, between you and me, I'd just keep my head down; the DHP is never going to know...",color:"secondary",timeout:2e3})},5e3);return}if(this.password!=="password")try{let e=await fetch(`http://ada.marlboroughcollege.org/api/v1/public/auth/login/${this.username}/${this.password}`);if(!e.ok)throw e.message;(await e.json()).success?(console.log("logging in as ",this.username),o.dispatch("setCurrentUser",this.username),o.dispatch("setAuthState",!0),this.$router.replace("/saturdays")):this.loginFailed=!0}catch(e){console.log(e)}else this.password==="password"?(console.log("logging in as ",this.username),o.dispatch("setCurrentUser",this.username),o.dispatch("setAuthState",!0),this.$router.replace("/saturdays")):console.log("did not log in ",this.username," using ",this.password)}}},V=e=>(b("data-v-07500ce0"),e=e(),A(),e),L={class:"container"},I=V(()=>p("div",{class:"text-right"},"forgot password?",-1)),Q={class:"text-left text-red"};function k(e,t,l,d,a,r){return m(),w("div",L,[s(c,{class:"q-pa-md q-pt-xl column q-gutter-md absolute-right shadow-2 bg-white",style:{width:"350px",height:"100%"}},{default:i(()=>[s(u,{class:"text-h3"},{default:i(()=>[_(" wADA ")]),_:1}),s(u,null,{default:i(()=>[s(h,{modelValue:a.username,"onUpdate:modelValue":t[0]||(t[0]=n=>a.username=n),label:"User Initials",options:a.options,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",loading:!r.dataAvailable,onFilter:r.filterFn,onInputValue:r.setModel},null,8,["modelValue","options","loading","onFilter","onInputValue"]),s(g,{modelValue:a.password,"onUpdate:modelValue":t[1]||(t[1]=n=>a.password=n),label:"password",type:"password",onKeyup:y(r.validateUser,["enter"])},null,8,["modelValue","onKeyup"]),I,v(p("div",Q," Username or password not recognised ",512),[[U,a.loginFailed]])]),_:1}),s(C,{align:"right"},{default:i(()=>[s(x,{rounded:"",flat:"",label:"login",class:"bg-primary text-white",onClick:r.validateUser},null,8,["onClick"])]),_:1})]),_:1})])}var W=f(S,[["render",k],["__scopeId","data-v-07500ce0"]]);export{W as default};
