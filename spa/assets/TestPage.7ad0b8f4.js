import{Q as C}from"./QInput.82dc4243.js";import{_ as b,o as i,c as u,at as n,r as w,X as f,Z as h,aN as E,aO as V,T as y,aP as D,Y as A,P as g,S as m,s as _,$ as S,U as d,W as I,B as c}from"./index.d8108594.js";import{Q as x}from"./QPage.d90d5951.js";import{B as O}from"./BaseCard.febaec81.js";import"./uid.afa002be.js";import"./focus-manager.d6507951.js";const j={props:{title:{type:String,required:!1}}},B=a=>(E("data-v-2ef184c1"),a=a(),V(),a),N=B(()=>n("div",null,null,-1)),T={open:""};function q(a,e,t,o,r,l){return i(),u(h,null,[N,n("dialog",T,[n("header",null,[w(a.$slots,"header",{},()=>[n("h2",null,f(t.title),1)],!0)]),n("section",null,[w(a.$slots,"default",{},void 0,!0)]),n("menu",null,[w(a.$slots,"actions",{},void 0,!0)])])],64)}var W=b(j,[["render",q],["__scopeId","data-v-2ef184c1"]]);const U={props:{modelValue:{},label:{required:!0,type:Number},member:{required:!1},isEditable:{type:Boolean,required:!0}},emits:["update:modelValue","update-array"],methods:{submitData(){this.$emit("update:modelValue",this.$refs.staffname.value),this.$emit("update-array")},warnMessage(){this.isWarning=!0},clickOK(){this.isWarning=!1,document.getElementById(this.member).focus()}},data(){return{isWarning:!1}},components:{WarningPopup:W}},K=a=>(E("data-v-0ba533a8"),a=a(),V(),a),M={for:"staffname"},Q=["id"],L={key:1},F=["id","value"],J=K(()=>n("p",null,"Press enter to submit your change when done.",-1));function R(a,e,t,o,r,l){const p=y("WarningPopup");return i(),u("div",null,[n("label",M,f(t.label),1),t.member?t.member&&!t.isEditable?(i(),u("span",L,f(t.member),1)):t.member&&t.isEditable?(i(),u("input",{key:2,id:t.member,value:t.member,ref:"staffname",onClick:e[2]||(e[2]=(...s)=>l.warnMessage&&l.warnMessage(...s)),onKeyup:e[3]||(e[3]=D((...s)=>l.submitData&&l.submitData(...s),["enter"]))},null,40,F)):A("",!0):(i(),u("input",{key:0,id:t.member,ref:"staffname",onBlur:e[0]||(e[0]=(...s)=>l.submitData&&l.submitData(...s)),onKeyup:e[1]||(e[1]=D(s=>s.target.blur(),["enter"]))},null,40,Q)),r.isWarning?(i(),g(p,{key:3,title:"Warning"},{default:m(()=>[n("p",null,"You are about to take a duty away from "+f(t.member)+", who beat you to the slot. This should only be done if you are legitimately swapping with that person, otherwise you are a dick. An email detailing this change will be sent to the deputy head pastoral.",1),J]),actions:m(()=>[n("button",{onClick:e[4]||(e[4]=(...s)=>l.clickOK&&l.clickOK(...s)),style:{width:"20%"}},"OK")]),_:1})):A("",!0)])}var Y=b(U,[["render",R],["__scopeId","data-v-0ba533a8"]]);const H={mounted(){this.staffArray=this.staff},data(){return{staffArray:[],isEditable:!1}},emits:["update-staff"],components:{StaffInput:Y,BaseCard:O},props:{id:{type:String},yeargroup:{type:String,required:!0},title:{type:String,required:!0},location:{type:String,required:!0},staff:{type:Array,required:!0},date_id:{type:Number,required:!0}},methods:{updateStaff(){console.log("DutyCard says: "),console.log(this.staffArray);const a={id:this.id,staff:this.staffArray};console.log("DutyCard calling updateStaff from the store and sending ",a),_.dispatch("updateStaff",a),this.isEditable=!1},editStaff(){this.isEditable=!0}}},X={class:"text-h5 text-weight-bold"},Z={class:"text-h4"},z={class:"text-h6"},G={class:"infopanel"},$={class:"button-holder"};function ee(a,e,t,o,r,l){const p=y("staff-input"),s=y("base-card");return i(),g(s,{styleType:t.yeargroup},{default:m(()=>[n("header",null,[n("div",X,f(t.yeargroup),1),n("div",Z,f(t.title),1),n("div",z,f(t.location),1)]),n("div",G,[(i(!0),u(h,null,S(r.staffArray,(k,v)=>(i(),g(p,{key:k,member:k,label:v+1,modelValue:r.staffArray[v],"onUpdate:modelValue":P=>r.staffArray[v]=P,isEditable:this.isEditable,onUpdateArray:l.updateStaff},null,8,["member","label","modelValue","onUpdate:modelValue","isEditable","onUpdateArray"]))),128))]),n("div",$,[d(c,{color:"grey-7",onClick:l.editStaff},{default:m(()=>[I("Edit Staff")]),_:1},8,["onClick"])])]),_:1},8,["styleType"])}var te=b(H,[["render",ee],["__scopeId","data-v-6dd9339e"]]);const ae={components:{DutyCard:te},data(){return{number:null,username:null,password:null,name:"",location:"",staffArray:[],array:[],response:"no response yet",id:null,eventids:[]}},computed:{events(){return _.getters.getEvents}},methods:{setValue(){console.log(this.array)},submit(){let a=Array(this.number);this.array=a},async testAuth(){if(this.username&&this.password){let e=await(await fetch(`http://ada.marlboroughcollege.org/api/v1/public/auth/login/${this.username}/${this.password}`)).json();console.log(e),console.log(e.success)}},async getOne(){this.array=[];let e=await(await fetch(`http://localhost:80/api/v1/public/events/${this.number}`)).json(),t=new Array(e.staff_no);this.array.push({date:e.date_id,yeargroup:e.year_group,title:e.event_title,location:e.location,staff_no:t,id:e.event_id}),console.log(e),console.log(this.array)},async get(){this.array=[],this.eventids=[];let e=await(await fetch("http://localhost:80/api/v1/public/events")).json();this.response=e,console.log(e);for(let t=0;t<e.length;t++){let o=new Array(e[t].staff_no);this.array.push({date:e[t].date_id,yeargroup:e[t].year_group,title:e[t].event_title,location:e[t].location,staff_no:o,id:e[t].event_id}),this.eventids.push(e[t].event_id)}console.log("the array is: ",this.array)},async post(){let a=await fetch("http://localhost:80/api/v1/public/events",{method:"POST",body:JSON.stringify({date_id:4,location:"Court",staff_no:4,event_title:"Cage Fight: Shell vs The Master",year_group:"Shell"})}),e=await a.json();console.log(a),console.log(e.message),this.id=e.ID},async deleteEvent(){let a=await fetch(`http://localhost/api/v1/public/events/${this.number}`,{method:"DELETE"});console.log("attempting to delete item ",this.id);let e=await a.json();console.log(e),this.response=e},async updateEvent(){let e=await(await fetch(`http://localhost/api/v1/public/events/${this.number}`,{method:"PATCH",body:JSON.stringify({year_group:this.beanData})})).json();console.log(e)},async transferStaff(){let e=await(await fetch("https://wheatyfirstdatabase-default-rtdb.europe-west1.firebasedatabase.app/staffMembers.json")).json(),t=[];for(let o in e)t.push({first_name:e[o].firstName,last_name:e[o].lastName,initials:e[o].initials,email:e[o].email,role:e[o].role});console.log(e),console.log(t);for(let o in t){let l=await(await fetch("http://localhost:80/api/v1/public/staff",{method:"POST",body:JSON.stringify({first_name:t[o].first_name,last_name:t[o].last_name,initials:t[o].initials,email:t[o].email,role:t[o].role})})).json();console.log("response from API: ",l)}},async testDates(){let a=await response.json();console.log(a)},async testLoading(){let e=await(await fetch("http://localhost/api/v1/public/events/2/loading")).json();console.log(e)},testStore(){const a=_.getters.getDates;console.log(a)},async selectStaff(a){let t=await(await fetch(_.getters.getServerURL+`api/v1/public/events/${a}/loading`)).json();console.log(t)}}},se={class:"q-pa-md row"};function le(a,e,t,o,r,l){const p=y("duty-card");return i(),u("div",se,[n("div",null,[d(C,{label:"username",modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=s=>r.username=s)},null,8,["modelValue"]),d(C,{type:"password",label:"password",modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=s=>r.password=s)},null,8,["modelValue"]),n("p",null,"ID of most recently created resource = "+f(r.id),1),(i(!0),u(h,null,S(r.eventids,s=>(i(),u("p",{key:s},[I(" All IDs "),n("span",null,f(s),1)]))),128)),d(c,{label:"test Auth",onClick:l.testAuth},null,8,["onClick"]),d(c,{label:"delete",onClick:l.deleteEvent},null,8,["onClick"]),d(c,{label:"get",onClick:l.get},null,8,["onClick"]),d(c,{label:"get One",onClick:l.getOne},null,8,["onClick"]),d(c,{label:"update",onClick:l.updateEvent},null,8,["onClick"]),d(c,{label:"transfer",onClick:l.transferStaff},null,8,["onClick"]),d(c,{label:"testDates",onClick:l.testDates},null,8,["onClick"]),d(c,{label:"selectStaff",onClick:e[2]||(e[2]=s=>l.selectStaff(12))}),(i(!0),u(h,null,S(r.array,s=>(i(),g(x,{key:s.id},{default:m(()=>[d(p,{location:s.location,id:s.id,yeargroup:s.yeargroup,title:s.title,date:s.date,staff:s.staff_no},null,8,["location","id","yeargroup","title","date","staff"])]),_:2},1024))),128))])])}var ce=b(ae,[["render",le],["__scopeId","data-v-398165bf"]]);export{ce as default};
